# Руководство по работе с проектом

Этот документ описывает процессы разработки, ветвления и сборки, а также как эффективно пользоваться текущей архитектурой монорепозитория.

## 1) Базовая информация
- Путь к проекту: `/home/craz/Learn/http`
- ОС/шелл: Linux, `/usr/bin/zsh`
- Основная ветка: `main`
- Язык общения: русский

## 2) Монорепозиторий и сервисы
- `services/http_service` — FastAPI‑приложение; универсальный маршрутизатор/логгер, Alembic‑миграции.
- `services/tg_bot` — Telegram‑бот (aiogram) с собственной БД: приветствия, интенты, меню, история сообщений.
- `services/ai_service` — AI‑сервис (FastAPI) с подключением к Ollama (`mistral`), собственная БД для сессий и сообщений.
- `adm_web` — PHP/Yii2 админка (отдельный репозиторий как build‑контекст).
- Мониторинг: Grafana + Loki + Promtail (дашборд провижинен).

## 3) Ветвление и Git‑процесс
- Рабочие ветки от `main`: `feat/*`, `fix/*`, `chore/*`, `docs/*`, `ci/*`, `perf/*`.
- По завершении — PR в `main` (ветки не удаляем). Историю коммитов поддерживаем чистой; предпочтительно squash/rebase перед merge.
- Сообщения коммитов: Conventional Commits.

## 4) Запуск и окружение
- Основной способ — Docker Compose: `docker compose up -d`.
- Переменные окружения см. в `README.md` (раздел “Переменные окружения”).
- Makefile предоставляет короткие команды для dev‑цикла.

## 5) Тесты и качество
- Unit/интеграционные тесты запускаются через `make test`.
- В репозитории настроен CI (GitHub Actions) для авто‑прогонов.
- Рекомендуется использовать pre-commit хуки (линты, форматтеры, быстрые проверки).

## 6) Документация
- Высокоуровневое описание и быстрый старт: `README.md`.
- Техническая документация HTTP‑сервиса: `TECHNICAL.md`.
- Правила вклада и коммитов: `CONTRIBUTING.md`.
- Изменения по версиям: `CHANGELOG.md`.

## 7) Секреты и безопасность
- Не хранить токены в истории Git. При утечке — переписать историю и форс‑пуш с `--force-with-lease`.
- Секреты задаём через `.env`/CI variables.

## 8) Траблшутинг
- Бот молчит: смотрим Grafana/Loki, фильтр `{service="tg_bot"}` и ошибки.
- AI не отвечает: `/generate` локально, затем логи `{service="ai_service"}` и ошибки к Ollama.

